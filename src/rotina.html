<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SisEd - Sistema de Prescri√ß√£o M√©dica</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüè•%3C/text%3E%3C/svg%3E">
    
    <!-- Estilos -->
    <link rel="stylesheet" href="../assets/styles/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* Estilos espec√≠ficos da p√°gina de rotina */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .quick-action-btn {
            background: white;
            border: 2px solid var(--gray-light);
            border-radius: 10px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .quick-action-btn:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .quick-action-btn i {
            font-size: 24px;
            color: var(--primary);
        }
        
        .quick-action-btn span {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        /* Tabs espec√≠ficas */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Cards de pacientes */
        .patient-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .patient-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid var(--primary);
            box-shadow: var(--shadow);
        }
        
        .patient-card h4 {
            color: var(--primary-dark);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .patient-card p {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .patient-card .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .status.ativo {
            background: rgba(16, 185, 129, 0.1);
            color: #065f46;
        }
        
        .status.alta {
            background: rgba(245, 158, 11, 0.1);
            color: #92400e;
        }
        
        /* Filtros */
        .filters {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }
        
        .filter-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: flex-end;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        /* Status do sistema */
        .system-status {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .status-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            flex: 1;
            min-width: 150px;
            text-align: center;
            box-shadow: var(--shadow);
        }
        
        .status-item i {
            font-size: 24px;
            margin-bottom: 10px;
            display: block;
        }
        
        .status-item.success i {
            color: var(--secondary);
        }
        
        .status-item.warning i {
            color: var(--warning);
        }
        
        .status-item.info i {
            color: var(--primary);
        }
        
        .status-number {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .status-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* Timeline de atividades */
        .activity-timeline {
            margin-top: 30px;
        }
        
        .timeline-item {
            display: flex;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .timeline-item:last-child {
            border-bottom: none;
        }
        
        .timeline-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .timeline-content {
            flex: 1;
        }
        
        .timeline-time {
            color: var(--gray);
            font-size: 0.85rem;
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .filter-row {
                flex-direction: column;
            }
            
            .filter-group {
                width: 100%;
            }
            
            .patient-grid {
                grid-template-columns: 1fr;
            }
            
            .system-status {
                flex-direction: column;
            }
            
            .nav-tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
            }
            
            .tab-btn {
                white-space: nowrap;
            }
        }
        
        /* Anima√ß√µes */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <img src="../assets/images/LOGOMA.jpg" alt="Logo SisEd" style="height: 50px;">
                <div>
                    <h1>SisEd - Sistema de Prescri√ß√£o M√©dica</h1>
                    <p id="currentUnit" style="color: var(--gray); font-size: 0.9rem;">Unidade: UPA Centro</p>
                </div>
            </div>
            <div class="user-info">
                <div class="user-details">
                    <span id="username">Carregando...</span>
                    <small id="userRole" style="color: var(--gray); font-size: 0.8rem;">M√©dico</small>
                </div>
                <button class="btn-logout" onclick="auth.logout()">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </button>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <button class="tab-btn active" onclick="openTab('dashboard')" data-tab="dashboard">
                <i class="fas fa-home"></i> Dashboard
            </button>
            <button class="tab-btn" onclick="openTab('rotina')" data-tab="rotina">
                <i class="fas fa-calendar-alt"></i> Rotina Di√°ria
            </button>
            <button class="tab-btn" onclick="openTab('prescricao')" data-tab="prescricao">
                <i class="fas fa-prescription"></i> Prescri√ß√µes
            </button>
            <button class="tab-btn" onclick="openTab('pacientes')" data-tab="pacientes">
                <i class="fas fa-user-injured"></i> Pacientes
            </button>
            <button class="tab-btn" onclick="openTab('medicamentos')" data-tab="medicamentos">
                <i class="fas fa-pills"></i> Medicamentos
            </button>
            <button class="tab-btn" onclick="openTab('relatorios')" data-tab="relatorios">
                <i class="fas fa-chart-bar"></i> Relat√≥rios
            </button>
            <button class="tab-btn" onclick="openTab('config')" data-tab="config">
                <i class="fas fa-cog"></i> Configura√ß√µes
            </button>
        </nav>

        <!-- Main Content -->
        <main class="content">
            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content active">
                <div class="system-status">
                    <div class="status-item success">
                        <i class="fas fa-user-injured"></i>
                        <div class="status-number" id="totalPacientes">0</div>
                        <div class="status-label">Pacientes Ativos</div>
                    </div>
                    <div class="status-item warning">
                        <i class="fas fa-prescription"></i>
                        <div class="status-number" id="totalPrescricoes">0</div>
                        <div class="status-label">Prescri√ß√µes Hoje</div>
                    </div>
                    <div class="status-item info">
                        <i class="fas fa-hospital"></i>
                        <div class="status-number" id="totalUnidades">1</div>
                        <div class="status-label">Unidades</div>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-clock"></i>
                        <div class="status-number" id="horarioAtendimento">00:00</div>
                        <div class="status-label">Hor√°rio</div>
                    </div>
                </div>

                <!-- A√ß√µes R√°pidas -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">A√ß√µes R√°pidas</h2>
                    </div>
                    <div class="quick-actions">
                        <div class="quick-action-btn" onclick="novaPrescricaoRapida()">
                            <i class="fas fa-bolt"></i>
                            <span>Prescri√ß√£o R√°pida</span>
                        </div>
                        <div class="quick-action-btn" onclick="novoPaciente()">
                            <i class="fas fa-user-plus"></i>
                            <span>Novo Paciente</span>
                        </div>
                        <div class="quick-action-btn" onclick="abrirReceita()">
                            <i class="fas fa-file-medical"></i>
                            <span>Receita Especial</span>
                        </div>
                        <div class="quick-action-btn" onclick="abrirAtestado()">
                            <i class="fas fa-file-medical-alt"></i>
                            <span>Atestado M√©dico</span>
                        </div>
                        <div class="quick-action-btn" onclick="abrirExames()">
                            <i class="fas fa-vial"></i>
                            <span>Solicitar Exames</span>
                        </div>
                        <div class="quick-action-btn" onclick="abrirFluxos()">
                            <i class="fas fa-project-diagram"></i>
                            <span>Fluxos de Emerg√™ncia</span>
                        </div>
                    </div>
                </div>

                <!-- Atividades Recentes -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Atividades Recentes</h2>
                        <button class="btn" onclick="atualizarAtividades()">
                            <i class="fas fa-sync-alt"></i> Atualizar
                        </button>
                    </div>
                    <div class="activity-timeline" id="activityTimeline">
                        <!-- Atividades ser√£o carregadas aqui -->
                        <div class="timeline-item">
                            <div class="timeline-icon">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <div class="timeline-content">
                                <strong>Paciente Jo√£o Silva cadastrado</strong>
                                <p>Por Dr. Ana Santos</p>
                                <div class="timeline-time">H√° 5 minutos</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rotina Di√°ria Tab -->
            <div id="rotina-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Rotina Di√°ria</h2>
                        <div>
                            <button class="btn" onclick="imprimirRotina()">
                                <i class="fas fa-print"></i> Imprimir
                            </button>
                            <button class="btn btn-primary" onclick="novaRotina()">
                                <i class="fas fa-plus"></i> Nova Rotina
                            </button>
                        </div>
                    </div>
                    
                    <div class="filters">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label class="form-label">Data:</label>
                                <input type="date" id="dataRotina" class="form-control" value="">
                            </div>
                            
                            <div class="filter-group">
                                <label class="form-label">Unidade:</label>
                                <select id="unidade" class="form-control">
                                    <option value="">Todas as unidades</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label class="form-label">Status:</label>
                                <select id="filtroStatus" class="form-control">
                                    <option value="">Todos</option>
                                    <option value="ativo">Ativo</option>
                                    <option value="alta">Alta</option>
                                    <option value="pendente">Pendente</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label class="form-label">&nbsp;</label>
                                <button class="btn btn-primary" onclick="filtrarRotinas()" style="width: 100%;">
                                    <i class="fas fa-filter"></i> Filtrar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Formul√°rio de Nova Rotina -->
                    <div id="novaRotinaForm" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">Paciente:</label>
                            <input type="text" id="paciente" class="form-control" placeholder="Nome completo do paciente">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Prontu√°rio:</label>
                            <input type="text" id="prontuario" class="form-control" placeholder="N√∫mero do prontu√°rio">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Medica√ß√£o:</label>
                            <textarea id="medicacao" class="form-control" rows="4" placeholder="Prescri√ß√£o m√©dica..."></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Dilui√ß√£o:</label>
                            <textarea id="diluicao" class="form-control" rows="2" placeholder="Dilui√ß√£o e administra√ß√£o..."></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Observa√ß√µes:</label>
                            <textarea id="observacoes" class="form-control" rows="3" placeholder="Observa√ß√µes importantes..."></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Status:</label>
                            <select id="status" class="form-control">
                                <option value="ativo">Ativo</option>
                                <option value="alta">Alta</option>
                                <option value="pendente">Pendente</option>
                            </select>
                        </div>

                        <div style="text-align: right; margin-top: 1rem;">
                            <button class="btn" onclick="cancelarRotina()">
                                Cancelar
                            </button>
                            <button class="btn btn-success" onclick="salvarRotina()">
                                <i class="fas fa-save"></i> Salvar Rotina
                            </button>
                        </div>
                        <hr style="margin: 20px 0;">
                    </div>

                    <!-- Lista de Rotinas -->
                    <div id="listaRotinasContainer">
                        <h3 style="margin-bottom: 15px;">Rotinas do Dia</h3>
                        <div id="lista-rotinas">
                            <!-- Dados carregados via JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Outras Tabs (simplificadas) -->
            <div id="prescricao-tab" class="tab-content">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    Redirecionando para Prescri√ß√£o Completa...
                </div>
            </div>

            <div id="pacientes-tab" class="tab-content">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    Redirecionando para Gest√£o de Pacientes...
                </div>
            </div>

            <div id="medicamentos-tab" class="tab-content">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    Redirecionando para Cat√°logo de Medicamentos...
                </div>
            </div>

            <div id="relatorios-tab" class="tab-content">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    Redirecionando para Relat√≥rios...
                </div>
            </div>

            <div id="config-tab" class="tab-content">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    Redirecionando para Configura√ß√µes...
                </div>
            </div>
        </main>
    </div>

    <!-- Modal para editar rotina -->
    <div id="modal-rotina" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Rotina</h3>
                <button class="btn-close" onclick="fecharModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-editar-rotina">
                    <input type="hidden" id="edit-id">
                    <div class="form-group">
                        <label class="form-label">Data:</label>
                        <input type="date" id="edit-data" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Paciente:</label>
                        <input type="text" id="edit-paciente" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Medica√ß√£o:</label>
                        <textarea id="edit-medicacao" class="form-control" rows="4" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Observa√ß√µes:</label>
                        <textarea id="edit-observacoes" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status:</label>
                        <select id="edit-status" class="form-control">
                            <option value="ativo">Ativo</option>
                            <option value="alta">Alta</option>
                            <option value="pendente">Pendente</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="fecharModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="atualizarRotina()">Salvar Altera√ß√µes</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../src/js/auth-check.js"></script>
    <script src="../data/config.js"></script>
    <script src="../data/rotina-data.js"></script>
    <script src="../src/js/rotina-logic.js"></script>
    <script>
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar autentica√ß√£o
            const usuario = auth.verificarAutenticacao();
            
            if (usuario) {
                // Configurar interface
                document.getElementById('username').textContent = usuario.nome || usuario.usuario;
                document.getElementById('userRole').textContent = formatarNivel(usuario.nivel);
                
                // Carregar dados iniciais
                inicializarRotina();
                
                // Atualizar hor√°rio
                atualizarHorario();
                setInterval(atualizarHorario, 60000);
                
                // Carregar estat√≠sticas
                carregarEstatisticas();
            }
        });
        
        // Fun√ß√µes de navega√ß√£o
        function openTab(tabName) {
            // Esconder todas as tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remover active de todos os bot√µes
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar tab selecionada
            const tabElement = document.getElementById(`${tabName}-tab`);
            if (tabElement) {
                tabElement.classList.add('active');
                
                // Adicionar active ao bot√£o correspondente
                const activeBtn = document.querySelector(`.tab-btn[data-tab="${tabName}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }
                
                // Atualizar URL sem recarregar
                history.pushState(null, null, `#${tabName}`);
                
                // Carregar dados espec√≠ficos da tab
                switch(tabName) {
                    case 'dashboard':
                        carregarDashboard();
                        break;
                    case 'rotina':
                        carregarRotinas();
                        break;
                    case 'prescricao':
                        // Redirecionar ou carregar inline
                        setTimeout(() => {
                            window.location.href = 'prescricao.html';
                        }, 300);
                        break;
                }
            }
        }
        
        // Inicializar rotina
        function inicializarRotina() {
            // Configurar data atual
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('dataRotina').value = hoje;
            
            // Carregar unidades
            carregarUnidades();
            
            // Carregar rotinas do dia
            carregarRotinas();
        }
        
        // Fun√ß√µes de rotina
        function novaRotina() {
            const form = document.getElementById('novaRotinaForm');
            form.style.display = 'block';
            document.getElementById('paciente').focus();
            form.scrollIntoView({ behavior: 'smooth' });
        }
        
        function cancelarRotina() {
            document.getElementById('novaRotinaForm').style.display = 'none';
            limparFormularioRotina();
        }
        
        function limparFormularioRotina() {
            document.getElementById('paciente').value = '';
            document.getElementById('prontuario').value = '';
            document.getElementById('medicacao').value = '';
            document.getElementById('diluicao').value = '';
            document.getElementById('observacoes').value = '';
            document.getElementById('status').value = 'ativo';
        }
        
        function salvarRotina() {
            const paciente = document.getElementById('paciente').value.trim();
            const medicacao = document.getElementById('medicacao').value.trim();
            
            if (!paciente || !medicacao) {
                utils.mostrarAlerta('Preencha pelo menos paciente e medica√ß√£o!', 'error');
                return;
            }
            
            const rotina = {
                id: Date.now(),
                data: document.getElementById('dataRotina').value,
                paciente: paciente,
                prontuario: document.getElementById('prontuario').value,
                medicacao: medicacao,
                diluicao: document.getElementById('diluicao').value,
                observacoes: document.getElementById('observacoes').value,
                status: document.getElementById('status').value,
                usuario: auth.getUsuarioAtual().nome,
                dataCriacao: new Date().toISOString()
            };
            
            // Adicionar √† lista (simula√ß√£o)
            const rotinas = JSON.parse(localStorage.getItem('sismed_rotinas') || '[]');
            rotinas.unshift(rotina);
            localStorage.setItem('sismed_rotinas', JSON.stringify(rotinas));
            
            utils.mostrarAlerta('Rotina salva com sucesso!', 'success');
            cancelarRotina();
            carregarRotinas();
        }
        
        function carregarRotinas() {
            const rotinas = JSON.parse(localStorage.getItem('sismed_rotinas') || '[]');
            const dataSelecionada = document.getElementById('dataRotina').value;
            const unidadeSelecionada = document.getElementById('unidade').value;
            const statusSelecionado = document.getElementById('filtroStatus').value;
            
            // Filtrar rotinas
            let rotinasFiltradas = rotinas;
            
            if (dataSelecionada) {
                rotinasFiltradas = rotinasFiltradas.filter(r => r.data === dataSelecionada);
            }
            
            if (statusSelecionado) {
                rotinasFiltradas = rotinasFiltradas.filter(r => r.status === statusSelecionado);
            }
            
            // Exibir rotinas
            const container = document.getElementById('lista-rotinas');
            
            if (rotinasFiltradas.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        Nenhuma rotina encontrada para os filtros selecionados.
                    </div>
                `;
                return;
            }
            
            let html = '<div class="patient-grid">';
            
            rotinasFiltradas.forEach(rotina => {
                const dataFormatada = utils.formatarData(rotina.data);
                const statusClass = `status ${rotina.status}`;
                const statusText = rotina.status === 'ativo' ? 'Ativo' : 
                                  rotina.status === 'alta' ? 'Alta' : 'Pendente';
                
                html += `
                    <div class="patient-card">
                        <h4>${rotina.paciente}</h4>
                        ${rotina.prontuario ? `<p><strong>Prontu√°rio:</strong> ${rotina.prontuario}</p>` : ''}
                        <p><strong>Data:</strong> ${dataFormatada}</p>
                        <p><strong>M√©dico:</strong> ${rotina.usuario}</p>
                        <p>${rotina.medicacao.substring(0, 100)}${rotina.medicacao.length > 100 ? '...' : ''}</p>
                        <span class="${statusClass}">${statusText}</span>
                        <div class="table-actions" style="margin-top: 15px;">
                            <button class="btn" onclick="visualizarRotina(${rotina.id})">
                                <i class="fas fa-eye"></i> Ver
                            </button>
                            <button class="btn" onclick="editarRotina(${rotina.id})">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn" onclick="excluirRotina(${rotina.id})">
                                <i class="fas fa-trash"></i> Excluir
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function filtrarRotinas() {
            carregarRotinas();
        }
        
        function carregarUnidades() {
            const unidades = [
                { id: 1, nome: "UPA Centro" },
                { id: 2, nome: "UPA Zona Norte" },
                { id: 3, nome: "Hospital Municipal" },
                { id: 4, nome: "Cl√≠nica da Fam√≠lia" }
            ];
            
            const select = document.getElementById('unidade');
            unidades.forEach(unidade => {
                const option = document.createElement('option');
                option.value = unidade.id;
                option.textContent = unidade.nome;
                select.appendChild(option);
            });
        }
        
        function editarRotina(id) {
            const rotinas = JSON.parse(localStorage.getItem('sismed_rotinas') || '[]');
            const rotina = rotinas.find(r => r.id === id);
            
            if (!rotina) return;
            
            document.getElementById('edit-id').value = rotina.id;
            document.getElementById('edit-data').value = rotina.data;
            document.getElementById('edit-paciente').value = rotina.paciente;
            document.getElementById('edit-medicacao').value = rotina.medicacao;
            document.getElementById('edit-observacoes').value = rotina.observacoes || '';
            document.getElementById('edit-status').value = rotina.status;
            
            document.getElementById('modal-rotina').classList.add('active');
        }
        
        function atualizarRotina() {
            const id = parseInt(document.getElementById('edit-id').value);
            let rotinas = JSON.parse(localStorage.getItem('sismed_rotinas') || '[]');
            const index = rotinas.findIndex(r => r.id === id);
            
            if (index === -1) return;
            
            rotinas[index] = {
                ...rotinas[index],
                data: document.getElementById('edit-data').value,
                paciente: document.getElementById('edit-paciente').value,
                medicacao: document.getElementById('edit-medicacao').value,
                observacoes: document.getElementById('edit-observacoes').value,
                status: document.getElementById('edit-status').value,
                dataAtualizacao: new Date().toISOString()
            };
            
            localStorage.setItem('sismed_rotinas', JSON.stringify(rotinas));
            carregarRotinas();
            fecharModal();
            utils.mostrarAlerta('Rotina atualizada com sucesso!', 'success');
        }
        
        function visualizarRotina(id) {
            const rotinas = JSON.parse(localStorage.getItem('sismed_rotinas') || '[]');
            const rotina = rotinas.find(r => r.id === id);
            
            if (!rotina) return;
            
            alert(`
                === ROTINA M√âDICA ===
                Data: ${utils.formatarData(rotina.data)}
                Paciente: ${rotina.paciente}
                Prontu√°rio: ${rotina.prontuario || 'N√£o informado'}
                
                MEDICA√á√ÉO:
                ${rotina.medicacao}
                
                ${rotina.diluicao ? `DILUI√á√ÉO:\n${rotina.diluicao}\n` : ''}
                OBSERVA√á√ïES:
                ${rotina.observacoes || 'Nenhuma'}
                
                Status: ${rotina.status === 'ativo' ? 'Ativo' : rotina.status === 'alta' ? 'Alta' : 'Pendente'}
                M√©dico: ${rotina.usuario}
                Criado em: ${utils.formatarDataHora(rotina.dataCriacao)}
                ${rotina.dataAtualizacao ? `Atualizado em: ${utils.formatarDataHora(rotina.dataAtualizacao)}` : ''}
            `);
        }
        
        function excluirRotina(id) {
            if (!confirm('Tem certeza que deseja excluir esta rotina?')) return;
            
            let rotinas = JSON.parse(localStorage.getItem('sismed_rotinas') || '[]');
            rotinas = rotinas.filter(r => r.id !== id);
            localStorage.setItem('sismed_rotinas', JSON.stringify(rotinas));
            carregarRotinas();
            utils.mostrarAlerta('Rotina exclu√≠da com sucesso!', 'success');
        }
        
        function fecharModal() {
            document.getElementById('modal-rotina').classList.remove('active');
        }
        
        function imprimirRotina() {
            window.print();
        }
        
        // Dashboard functions
        function carregarDashboard() {
            atualizarHorario();
            carregarEstatisticas();
        }
        
        function atualizarHorario() {
            const agora = new Date();
            const horario = agora.toLocaleTimeString('pt-BR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            document.getElementById('horarioAtendimento').textContent = horario;
        }
        
        function carregarEstatisticas() {
            const rotinas = JSON.parse(localStorage.getItem('sismed_rotinas') || '[]');
            const hoje = new Date().toISOString().split('T')[0];
            
            // Pacientes ativos
            const pacientesAtivos = rotinas.filter(r => r.status === 'ativo').length;
            document.getElementById('totalPacientes').textContent = pacientesAtivos;
            
            // Prescri√ß√µes hoje
            const prescricoesHoje = rotinas.filter(r => r.data === hoje).length;
            document.getElementById('totalPrescricoes').textContent = prescricoesHoje;
        }
        
        // Fun√ß√µes de navega√ß√£o r√°pida
        function novaPrescricaoRapida() {
            window.location.href = 'prescricaofast.html';
        }
        
        function novoPaciente() {
            utils.mostrarAlerta('Fun√ß√£o em desenvolvimento', 'info');
        }
        
        function abrirReceita() {
            window.location.href = 'receitaespecial.html';
        }
        
        function abrirAtestado() {
            utils.mostrarAlerta('M√≥dulo de atestado em desenvolvimento', 'info');
        }
        
        function abrirExames() {
            utils.mostrarAlerta('M√≥dulo de exames em desenvolvimento', 'info');
        }
        
        function abrirFluxos() {
            window.location.href = 'fluxos.html';
        }
        
        function atualizarAtividades() {
            utils.mostrarAlerta('Atividades atualizadas', 'success');
        }
        
        // Utilit√°rios
        function formatarNivel(nivel) {
            const niveis = {
                'admin': 'Administrador',
                'medico': 'M√©dico',
                'enfermeiro': 'Enfermeiro',
                'usuario': 'Usu√°rio'
            };
            return niveis[nivel] || nivel;
        }
        
        // Verificar hash na URL para tab ativa
        window.addEventListener('hashchange', function() {
            const hash = window.location.hash.substring(1);
            if (hash) {
                openTab(hash);
            }
        });
        
        // Inicializar com hash da URL
        if (window.location.hash) {
            const hash = window.location.hash.substring(1);
            openTab(hash);
        }
    </script>
</body>
</html>